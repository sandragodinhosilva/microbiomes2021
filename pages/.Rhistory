for(col_iC in 1:ncol(NAMEc)){
if (!is.na(NAMEc[row_iC,col_iC])){
finalC[row_iC] <- as.character(NAMEc[row_iC,col_iC])
break
}
}
}
str(finalC)
#########################
#Descrition
finalDC <- character()
row_iDC <- 1
for (row_iDC in 1:nrow(Descriptionc)) {
for(col_iDC in 1:ncol(Descriptionc)){
if (!is.na(Descriptionc[row_iDC,col_iDC])){
finalDC[row_iDC] <- as.character(Descriptionc[row_iDC,col_iDC])
break
}
}
}
str(finalDC)
######################
#bind everything
COG_final <- cbind(finalC, finalDC, COG_only)
#correct column names
colnames(COG_final)[colnames(COG_final)=="finalC"] <- "Name"
colnames(COG_final)[colnames(COG_final)=="finalDC"] <- "Description"
colnames(COG_final) <- sub(".txt", "", colnames(COG_final))
#put Accession in first column
COG_final <- COG_final %>%
select(Accession, everything())
##############################################################################
#tab separated file
write.table(COG_final, "cog_table.txt", sep="\t", row.names = FALSE, quote=FALSE)
# SUBSTITUE  X with the number of files in analysis
for (i in 2:length(list.datac)){
final_mergec <- full_join(final_mergec, list.datac[[i]], by="Accession")
print(i)}
#changes NA to zero
final_mergec[is.na(final_mergec)] <- 0
str(final_mergec)
##########################################
NAME <- grep("Name", names(final_mergec))
DES <- grep("Description", names(final_mergec))
NAMEc <- final_mergec[, NAME]
Descriptionc <- final_mergec[, DES]
COG_only <- final_mergec[,-NAME]
DES2 <- grep("Description", names(COG_only))
COG_only <- COG_only[, -DES2]
#NAME
finalC <- character()
row_iC <- 1
for (row_iC in 1:nrow(NAMEc)) {
for(col_iC in 1:ncol(NAMEc)){
if (!is.na(NAMEc[row_iC,col_iC])){
finalC[row_iC] <- as.character(NAMEc[row_iC,col_iC])
break
}
}
}
str(finalC)
#########################
#Descrition
finalDC <- character()
row_iDC <- 1
for (row_iDC in 1:nrow(Descriptionc)) {
for(col_iDC in 1:ncol(Descriptionc)){
if (!is.na(Descriptionc[row_iDC,col_iDC])){
finalDC[row_iDC] <- as.character(Descriptionc[row_iDC,col_iDC])
break
}
}
}
str(finalDC)
######################
#bind everything
COG_final <- cbind(finalC, finalDC, COG_only)
#correct column names
colnames(COG_final)[colnames(COG_final)=="finalC"] <- "Name"
colnames(COG_final)[colnames(COG_final)=="finalDC"] <- "Description"
colnames(COG_final) <- sub(".txt", "", colnames(COG_final))
#put Accession in first column
COG_final <- COG_final %>%
select(Accession, everything())
#tab separated file
write.table(COG_final, "cog_table.txt", sep="\t", row.names = FALSE, quote=FALSE)
# Load package:
library("dplyr")
################################################################################
# ATTENTION
# Define directory where WebMGA files are (substitute with your path):
setwd("C:/Users/Sandra/OneDrive - Universidade de Lisboa/PhD_Related/6_Microbiomes_teaching/microbiomes2021/pages/data")
# Check if in correct directory:
getwd()
################################################################################
# List .txt files in the directory (The annotation files)
list.filenamesc <- list.files(pattern=".txt$")
str(list.filenamesc)
# Removes possible output already in this directory:
list.filenamesc[!grepl("cog_file.txt", list.filenamesc)]
# Creates an empty list that will serve as a container to receive the incoming files
list.datac <-list()
# Creates a loop to read the individual files data
for (i in 1:length(list.filenamesc))
{aux_listc<-read.table(list.filenamesc[i],
sep="\t", header=TRUE, quote="", fill=FALSE)
aux_listc<-aux_listc[,-c(4,5)]
colnames(aux_listc)[3]<-list.filenamesc[i]
list.datac[[i]]<-aux_listc
}
# Adds the names of your data to the list
names(list.datac) <- list.filenamesc
str(list.datac)
final_mergec<-list.datac[[1]]
################################################################################
# ATTENTION
# SUBSTITUE  X with the number of files in analysis
for (i in 2:length(list.datac)){
final_mergec <- full_join(final_mergec, list.datac[[i]], by="Accession")
print(i)}
################################################################################
#changes NA to zero
final_mergec[is.na(final_mergec)] <- 0
str(final_mergec)
##########################################
NAME <- grep("Name", names(final_mergec))
DES <- grep("Description", names(final_mergec))
NAMEc <- final_mergec[, NAME]
Descriptionc <- final_mergec[, DES]
COG_only <- final_mergec[,-NAME]
DES2 <- grep("Description", names(COG_only))
COG_only <- COG_only[, -DES2]
#NAME
finalC <- character()
row_iC <- 1
for (row_iC in 1:nrow(NAMEc)) {
for(col_iC in 1:ncol(NAMEc)){
if (!is.na(NAMEc[row_iC,col_iC])){
finalC[row_iC] <- as.character(NAMEc[row_iC,col_iC])
break
}
}
}
str(finalC)
#########################
#Descrition
finalDC <- character()
row_iDC <- 1
for (row_iDC in 1:nrow(Descriptionc)) {
for(col_iDC in 1:ncol(Descriptionc)){
if (!is.na(Descriptionc[row_iDC,col_iDC])){
finalDC[row_iDC] <- as.character(Descriptionc[row_iDC,col_iDC])
break
}
}
}
str(finalDC)
######################
#bind everything
COG_final <- cbind(finalC, finalDC, COG_only)
#correct column names
colnames(COG_final)[colnames(COG_final)=="finalC"] <- "Name"
colnames(COG_final)[colnames(COG_final)=="finalDC"] <- "Description"
colnames(COG_final) <- sub(".txt", "", colnames(COG_final))
#put Accession in first column
COG_final <- COG_final %>%
select(Accession, everything())
##############################################################################
#tab separated file
write.table(COG_final, "cog_table.txt", sep="\t", row.names = FALSE, quote=FALSE)
################################################################################
### Script for merging annotation tables from WebMGA
# This script can:
# open cog files
# merge results into a single table
# Steps where code modification is necessary are highlighted with "ATTENTION"
# The remaining comments are just here to help you understand the code
################################################################################
# Install necessary package:
# If the package dplyr is already installed, comment next line (add #):
install.packages('dplyr', repos = 'https://cloud.r-project.org')
# Load package:
library("dplyr")
################################################################################
# ATTENTION
# Define directory where WebMGA files are (substitute with your path):
setwd("C:/Users/Sandra/OneDrive - Universidade de Lisboa/PhD_Related/6_Microbiomes_teaching/microbiomes2021/pages/data")
# Check if in correct directory:
getwd()
################################################################################
# List .txt files in the directory (The annotation files)
list.filenamesc <- list.files(pattern=".txt$")
str(list.filenamesc)
# Removes possible output already in this directory:
list.filenamesc[!grepl("cog_file.txt", list.filenamesc)]
# Creates an empty list that will serve as a container to receive the incoming files
list.datac <-list()
# Creates a loop to read the individual files data
for (i in 1:length(list.filenamesc))
{aux_listc<-read.table(list.filenamesc[i],
sep="\t", header=TRUE, quote="", fill=FALSE)
aux_listc<-aux_listc[,-c(4,5)]
colnames(aux_listc)[3]<-list.filenamesc[i]
list.datac[[i]]<-aux_listc
}
# Adds the filenames of your data to the list
names(list.datac) <- list.filenamesc
str(list.datac)
final_mergec<-list.datac[[1]]
for (i in 2:length(list.datac)){
final_mergec <- full_join(final_mergec, list.datac[[i]], by="Accession")
print(i)}
# Changes NA to zero
final_mergec[is.na(final_mergec)] <- 0
str(final_mergec)
NAME <- grep("Name", names(final_mergec))
DES <- grep("Description", names(final_mergec))
NAMEc <- final_mergec[, NAME]
Descriptionc <- final_mergec[, DES]
COG_only <- final_mergec[,-NAME]
DES2 <- grep("Description", names(COG_only))
COG_only <- COG_only[, -DES2]
# Add NAME
finalC <- character()
row_iC <- 1
for (row_iC in 1:nrow(NAMEc)) {
for(col_iC in 1:ncol(NAMEc)){
if (!is.na(NAMEc[row_iC,col_iC])){
finalC[row_iC] <- as.character(NAMEc[row_iC,col_iC])
break
}
}
}
str(finalC)
# Add Description
finalDC <- character()
row_iDC <- 1
for (row_iDC in 1:nrow(Descriptionc)) {
for(col_iDC in 1:ncol(Descriptionc)){
if (!is.na(Descriptionc[row_iDC,col_iDC])){
finalDC[row_iDC] <- as.character(Descriptionc[row_iDC,col_iDC])
break
}
}
}
str(finalDC)
##############################################################################
# Join everything
COG_final <- cbind(finalC, finalDC, COG_only)
# Correct column names
colnames(COG_final)[colnames(COG_final)=="finalC"] <- "Name"
colnames(COG_final)[colnames(COG_final)=="finalDC"] <- "Description"
colnames(COG_final) <- sub(".txt", "", colnames(COG_final))
# Move COG identifiers to first column
COG_final <- COG_final %>%
select(Accession, everything())
##############################################################################
# Creates Tab separated file
write.table(COG_final, "cog_table.txt", sep="\t", row.names = FALSE, quote=FALSE)
install.packages("dplyr", repos = "https://cloud.r-project.org")
write.table(COG_final, "cog_table.csv", sep=",", row.names = FALSE, quote=FALSE)
################################################################################
### Script to merge annotation tables from WebMGA
# This script can:
# open cog files
# merge results into a single table
# Steps where code modification is necessary are highlighted with "ATTENTION"
# The remaining comments are just here to help you understand the code
# Author: Sandra Godinho Silva (sandragodinhosilva@tecnico.ulisboa.pt)
# Last version: 15-04-2021
################################################################################
# Install necessary package:
# If the package dplyr is already installed, comment next line (add #):
install.packages('dplyr', repos = 'https://cloud.r-project.org')
# Load package:
library("dplyr")
################################################################################
# ATTENTION
# Define directory where WebMGA files are (substitute with your path):
setwd("C:/Users/Sandra/OneDrive - Universidade de Lisboa/PhD_Related/6_Microbiomes_teaching/microbiomes2021/pages/data")
# Check if in correct directory:
getwd()
################################################################################
# List .txt files in the directory (The annotation files)
list.filenamesc <- list.files(pattern=".txt$")
str(list.filenamesc)
# Removes possible output already in this directory:
list.filenamesc[!grepl("cog_file.txt", list.filenamesc)]
# Creates an empty list that will serve as a container to receive the incoming files
list.datac <-list()
# Creates a loop to read the individual files data
for (i in 1:length(list.filenamesc))
{aux_listc<-read.table(list.filenamesc[i],
sep="\t", header=TRUE, quote="", fill=FALSE)
aux_listc<-aux_listc[,-c(4,5)]
colnames(aux_listc)[3]<-list.filenamesc[i]
list.datac[[i]]<-aux_listc
}
# Adds the filenames of your data to the list
names(list.datac) <- list.filenamesc
str(list.datac)
final_mergec<-list.datac[[1]]
for (i in 2:length(list.datac)){
final_mergec <- full_join(final_mergec, list.datac[[i]], by="Accession")
print(i)}
# Changes NA to zero
final_mergec[is.na(final_mergec)] <- 0
str(final_mergec)
NAME <- grep("Name", names(final_mergec))
DES <- grep("Description", names(final_mergec))
NAMEc <- final_mergec[, NAME]
Descriptionc <- final_mergec[, DES]
COG_only <- final_mergec[,-NAME]
DES2 <- grep("Description", names(COG_only))
COG_only <- COG_only[, -DES2]
# Add NAME
finalC <- character()
row_iC <- 1
for (row_iC in 1:nrow(NAMEc)) {
for(col_iC in 1:ncol(NAMEc)){
if (!is.na(NAMEc[row_iC,col_iC])){
finalC[row_iC] <- as.character(NAMEc[row_iC,col_iC])
break
}
}
}
str(finalC)
# Add Description
finalDC <- character()
row_iDC <- 1
for (row_iDC in 1:nrow(Descriptionc)) {
for(col_iDC in 1:ncol(Descriptionc)){
if (!is.na(Descriptionc[row_iDC,col_iDC])){
finalDC[row_iDC] <- as.character(Descriptionc[row_iDC,col_iDC])
break
}
}
}
str(finalDC)
##############################################################################
# Join everything
COG_final <- cbind(finalC, finalDC, COG_only)
# Correct column names
colnames(COG_final)[colnames(COG_final)=="finalC"] <- "Name"
colnames(COG_final)[colnames(COG_final)=="finalDC"] <- "Description"
colnames(COG_final) <- sub(".txt", "", colnames(COG_final))
# Move COG identifiers to first column
COG_final <- COG_final %>%
select(Accession, everything())
##############################################################################
# Creates Tab separated file
write.table(COG_final, "cog_table.csv", sep=",", row.names = FALSE, quote=FALSE)
write.csv(COG_final, "cog_table.csv", row.names = FALSE, quote=FALSE)
write.table(COG_final, "cog_table.tsv", sep="\t", row.names = FALSE, quote=FALSE)
##############################################################################
# Creates Tab separated file
write.table(COG_final, "cog_table.csv", sep=",", row.names = FALSE, quote=TRUE)
cog_table = read.csv("cog_output.csv")
head(cog_table)
################################################################################
### Script to merge annotation tables from WebMGA
# This script can:
# open cog files
# merge results into a single table
# Steps where code modification is necessary are highlighted with "ATTENTION"
# The remaining comments are just here to help you understand the code
# Author: Sandra Godinho Silva (sandragodinhosilva@tecnico.ulisboa.pt)
# Last version: 15-04-2021
################################################################################
# Install necessary package:
# If the package dplyr is already installed, comment next line (add #):
#install.packages('dplyr', repos = 'https://cloud.r-project.org')
# Load package:
library("dplyr")
################################################################################
# ATTENTION
# Define directory where WebMGA files are (substitute with your path):
setwd("C:/Users/Sandra/OneDrive - Universidade de Lisboa/PhD_Related/6_Microbiomes_teaching/microbiomes2021/pages/data")
# Check if in correct directory:
getwd()
################################################################################
# List .txt files in the directory (The annotation files)
list.filenamesc <- list.files(pattern=".txt$")
str(list.filenamesc)
# Removes possible output already in this directory:
list.filenamesc[!grepl("cog_file.txt", list.filenamesc)]
# Creates an empty list that will serve as a container to receive the incoming files
list.datac <-list()
# Creates a loop to read the individual files data
for (i in 1:length(list.filenamesc))
{aux_listc<-read.table(list.filenamesc[i],
sep="\t", header=TRUE, quote="", fill=FALSE)
aux_listc<-aux_listc[,-c(4,5)]
colnames(aux_listc)[3]<-list.filenamesc[i]
list.datac[[i]]<-aux_listc
}
# Adds the filenames of your data to the list
names(list.datac) <- list.filenamesc
str(list.datac)
final_mergec<-list.datac[[1]]
for (i in 2:length(list.datac)){
final_mergec <- full_join(final_mergec, list.datac[[i]], by="Accession")
print(i)}
# Changes NA to zero
final_mergec[is.na(final_mergec)] <- 0
str(final_mergec)
NAME <- grep("Name", names(final_mergec))
DES <- grep("Description", names(final_mergec))
NAMEc <- final_mergec[, NAME]
Descriptionc <- final_mergec[, DES]
COG_only <- final_mergec[,-NAME]
DES2 <- grep("Description", names(COG_only))
COG_only <- COG_only[, -DES2]
# Add NAME
finalC <- character()
row_iC <- 1
for (row_iC in 1:nrow(NAMEc)) {
for(col_iC in 1:ncol(NAMEc)){
if (!is.na(NAMEc[row_iC,col_iC])){
finalC[row_iC] <- as.character(NAMEc[row_iC,col_iC])
break
}
}
}
str(finalC)
# Add Description
finalDC <- character()
row_iDC <- 1
for (row_iDC in 1:nrow(Descriptionc)) {
for(col_iDC in 1:ncol(Descriptionc)){
if (!is.na(Descriptionc[row_iDC,col_iDC])){
finalDC[row_iDC] <- as.character(Descriptionc[row_iDC,col_iDC])
break
}
}
}
str(finalDC)
##############################################################################
# Join everything
COG_final <- cbind(finalC, finalDC, COG_only)
# Correct column names
colnames(COG_final)[colnames(COG_final)=="finalC"] <- "Name"
colnames(COG_final)[colnames(COG_final)=="finalDC"] <- "Description"
colnames(COG_final) <- sub(".txt", "", colnames(COG_final))
# Move COG identifiers to first column
COG_final <- COG_final %>%
select(Accession, everything())
##############################################################################
# Creates CSV (comma separated value) file
write.csv(COG_final, "cog_table.csv", row.names = FALSE, quote=TRUE)
################################################################################
# Exercise 1: Open "cog_output.file"
cog_table = read.csv("cog_table.csv")
head(cog_table)
# Open mapping file
cog_map = read.table("cog_mapping.tsv", sep="\t")
head(cog_map)
cog_map2 = read.table("cog_mapping2.tsv", sep="\t")
head(cog_map2)
cog_map2 = read.table("cog_mapping2.tsv", sep="\t",header=TRUE)
head(cog_map2)
cog_map = read.table("cog_mapping.tsv", sep="\t", header=TRUE)
head(cog_map)
cog_map2 = read.table("cog_mapping2.tsv", sep="\t",header=TRUE)
head(cog_map2)
cog_map2 = read.table("cog_mapping2.tsv", sep="\t", header=TRUE)
head(cog_map2)
merge(cog_table, cog_map2)
View(cog_table)
View(cog_map2)
head(merge_table)
merge_table = merge(cog_table, cog_map2, by.x="Accession", by.y="COG")
head(merge_table)
View(merge_table)
# Load necessary packages
library("dplyr")
merge_table %>% count(func)
%>% count(func)
merge_table %>% group_by(func)
%>% count(func)
merge_table %>%
group_by(func)  %>%
count(func)
merge_table %>%
group_by(func)  %>%
count()
merge_table %>%
summarize()
merge_table %>%
sumcount(func)
merge_table %>%
count(func)
View(cog_table)
samples = cog_table.columns
samples = cog_table.columns()
# Open mapping file
cog_map = read.table("cog_mapping.tsv", sep="\t", header=TRUE)
View(cog_map)
View(NAMEc)
samples = cog_table.colnames
samples = colnames(cog_table)
samples = setdiff(samples, remove)
samples[ , !names(samples) %in% remove] ## works as expected
cog_table[ , !names(cog_table) %in% remove] ## works as expected
!names(cog_table)
names(cog_table)
clear
clear()
version
getwd()
getwd()
1+1
